import{f as v,r as y,h as m,o as w,c as b,C as g,L as E}from"./entry.66808c07.js";import{u as p}from"./index.7b010e4a.js";import{_ as S}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.c111b088.js";const _=v({props:{schema:{type:Object,default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit"],setup(e,{expose:n,emit:r}){const i=Math.random().toString(36).substring(7),u=p(`form-${i}`);u.on(async t=>{var s;t.type!=="submit"&&((s=e.validateOn)!=null&&s.includes(t.type))&&await l(t.path,{silent:!0})});const a=y([]);m("form-errors",a),m("form-events",u);async function c(){let t=await e.validate(e.state);if(e.schema)if(J(e.schema))t=t.concat(await A(e.state,e.schema));else if($(e.schema))t=t.concat(await j(e.state,e.schema));else if(F(e.schema))t=t.concat(await k(e.state,e.schema));else if(B(e.schema))t=t.concat(await C(e.state,e.schema));else throw new Error("Form validation failed: Unsupported form schema");return t}async function l(t,s={silent:!1}){if(t){const o=a.value.filter(f=>f.path!==t),h=(await c()).filter(f=>f.path===t);a.value=o.concat(h)}else a.value=await c();if(!s.silent&&a.value.length>0)throw new Error(`Form validation failed: ${JSON.stringify(a.value,null,2)}`);return e.state}async function d(t){var o;(o=e.validateOn)!=null&&o.includes("submit")&&await l();const s=t;s.data=e.state,r("submit",t)}return n({validate:l,errors:a,setErrors(t,s){a.value=t,s?a.value=a.value.filter(o=>o.path!==s).concat(t):a.value=t},getErrors(t){return t?a.value.filter(s=>s.path===t):a.value},clear(t){t?a.value=a.value.filter(s=>s.path===t):a.value=[]}}),{onSubmit:d}}});function $(e){return e.validate&&e.__isYupSchema__}function O(e){return e.inner!==void 0}async function j(e,n){try{return await n.validate(e,{abortEarly:!1}),[]}catch(r){if(O(r))return r.inner.map(i=>({path:i.path??"",message:i.message}));throw r}}function J(e){return e.parse!==void 0}async function A(e,n){const r=await n.safeParseAsync(e);return r.success===!1?r.error.issues.map(i=>({path:i.path.join("."),message:i.message})):[]}function F(e){return e.validateAsync!==void 0&&e.id!==void 0}function Y(e){return e.isJoi===!0}async function k(e,n){try{return await n.validateAsync(e,{abortEarly:!1}),[]}catch(r){if(Y(r))return r.details.map(i=>({path:i.path.join("."),message:i.message}));throw r}}function B(e){return e._parse!==void 0}async function C(e,n){const r=await n._parse(e);return r.issues?r.issues.map(i=>({path:i.path.map(u=>u.key).join("."),message:i.message})):[]}function M(e,n,r,i,u,a){return w(),b("form",{onSubmit:n[0]||(n[0]=E((...c)=>e.onSubmit&&e.onSubmit(...c),["prevent"]))},[g(e.$slots,"default")],32)}const N=S(_,[["render",M]]);export{N as default};
